// src/components/simulations/VulnerabilityScannerSimulator.jsx
import React, { useState } from "react";

/**
 * VulnerabilityScannerSimulator.jsx
 * ---------------------------------
 * Simulates scanning a small virtual network for open ports and vulnerabilities.
 * Learners can â€œscanâ€, see sample CVEs, and prioritize fixes.
 */

export default function VulnerabilityScannerSimulator() {
  const [scanning, setScanning] = useState(false);
  const [results, setResults] = useState([]);

  const mockScanResults = [
    {
      host: "10.0.0.5",
      service: "Apache HTTPD 2.4.41",
      cve: "CVE-2021-40438",
      severity: "High",
      fix: "Upgrade to Apache 2.4.49 or later",
    },
    {
      host: "10.0.0.8",
      service: "OpenSSH 7.2p2",
      cve: "CVE-2018-15473",
      severity: "Medium",
      fix: "Update OpenSSH to 8.9 or disable password auth",
    },
    {
      host: "10.0.0.10",
      service: "MySQL 5.7.18",
      cve: "CVE-2019-5480",
      severity: "Critical",
      fix: "Patch to MySQL 8.0.27 or enable SSL connections",
    },
  ];

  const handleScan = () => {
    setScanning(true);
    setResults([]);
    setTimeout(() => {
      setResults(mockScanResults);
      setScanning(false);
    }, 2000);
  };

  return (
    <div className="max-w-3xl mx-auto p-6 bg-white dark:bg-gray-900 rounded-2xl shadow-md border border-gray-200 dark:border-gray-700">
      <h3 className="text-xl font-semibold text-indigo-700 dark:text-indigo-300 mb-4">
        ðŸ§­ Vulnerability Scanner Simulator
      </h3>
      <p className="text-gray-600 dark:text-gray-300 mb-4 text-sm">
        Simulate a vulnerability scan across a sample network and review detected issues.
      </p>
      <button
        onClick={handleScan}
        disabled={scanning}
        className={`px-6 py-2 rounded-md text-white font-medium ${
          scanning ? "bg-indigo-400 cursor-wait" : "bg-indigo-600 hover:bg-indigo-700"
        }`}
      >
        {scanning ? "Scanning..." : "Start Scan"}
      </button>

      {results.length > 0 && (
        <div className="mt-6">
          <table className="w-full border-collapse text-sm">
            <thead className="bg-indigo-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
              <tr>
                <th className="p-2 border">Host</th>
                <th className="p-2 border">Service</th>
                <th className="p-2 border">CVE</th>
                <th className="p-2 border">Severity</th>
                <th className="p-2 border">Recommended Fix</th>
              </tr>
            </thead>
            <tbody>
              {results.map((item, idx) => (
                <tr
                  key={idx}
                  className={`${
                    item.severity === "Critical"
                      ? "bg-red-50 dark:bg-red-900/30"
                      : item.severity === "High"
                      ? "bg-yellow-50 dark:bg-yellow-900/30"
                      : "bg-green-50 dark:bg-green-900/30"
                  } border-b dark:border-gray-700`}
                >
                  <td className="p-2 border">{item.host}</td>
                  <td className="p-2 border">{item.service}</td>
                  <td className="p-2 border font-mono">{item.cve}</td>
                  <td className="p-2 border font-semibold">{item.severity}</td>
                  <td className="p-2 border">{item.fix}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}
    </div>
  );
}
